# Init

## cleanup
nuv() {
    if [[ "$1" == "action" ]] && [[ "$2" == "update" ]]
    then /usr/local/bin/nuv "$@" --docker ghcr.io/nuvolaris/action-nodejs-v14:0.3.0-morpheus.22081008
    else /usr/local/bin/nuv "$@"
    fi
}

pwd #should be demo
rm -Rvf addr
nuv  action update addr/delall delall.js
nuv  action invoke addr/delall -r
nuv action list | awk '/private/ { print $1 }' | xargs -L1 nuv wsk action delete 
nuv package list | awk '/private/ { print $1 }' | xargs -L1 nuv wsk package delete 

MONGODB="mongodb://nuvolaris:s3cr3t@nuvolaris-mongodb-0.nuvolaris-mongodb-svc/nuvolaris"
nuv package update addr -p mongodb "$MONGODB"

//nuv package update addr -p mongodb 'mongodb://nuvolaris:nx2Tech715!@10.42.168.89/nuvolaris01'

## create packages and actions
nuv package list
nuv action list

# check connectivity to mongo
code -a ping.js
nuv action update addr/ping ping.js 
nuv invoke addr/ping

## get set and del
code -a find.js
nuv action update addr/find find.js --web=true
code -a insert.js
nuv action update addr/insert insert.js --web=true
code -a del.js
nuv action update addr/del del.js --web=true

# Test the actions

nuv i addr/insert name=Michele company=Nuvolaris phone=392 
nuv i addr/find name=Michele 
nuv i addr/del name=Michele
nuv i addr/find name=Michele

# Get all data
code -a all.js
nuv action update addr/all all.js --web=true
nuv invoke addr/all
nuv invoke addr/insert name=Michele company=Nuvolaris phone=392
nuv invoke addr/all
nuv invoke addr/insert name=Mirella company=Sciabarra phone=328
nuv invoke addr/all

# Create svelte app
## IN ANOTHER TERMINAL **
pwd
npx degit sveltejs/template addr
cd addr
npm install
npm run dev
## BACK TO THE FIRST ##

# Create a Svelte app
code -a App1.svelte
code -a App2.svelte
cat App1.svelte App2.svelte >addr/src/App.svelte
open http://localhost:8080

# Add an entry
code -a App2a.svelte
code -a App1a.svelte
cat App1.svelte App1a.svelte App2.svelte App2a.svelte >addr/src/App.svelte

# Remove an entry
code -a App1b.svelte
code -a App2b.svelte
cat App1.svelte App1a.svelte App1b.svelte App2.svelte App2a.svelte App2b.svelte >addr/src/App.svelte


